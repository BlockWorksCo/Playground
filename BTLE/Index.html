<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script>

count = 0;


//
// Perform a non-blocking send of an event to the remote device.
//
function NonBlockingSend( type, payload )
{
    $.ajax({ url: "http://localhost:8080/Send&type="+type+"?data="+payload,
        success: function(data)
        {
            //$("#div2").html('sddfsdf '+data);
        }
    });
}



//
// All events received from the remote device end up here to be transformed
// into js events.
//
function ProcessReceivedEvent( data )
{
    if(data.type == 456)
    {
        text    = "Timestamp is: " + data.timestamp + ", type is: " + data.type + ", payload is: " + data.payload
        $("#div1").html(text);
    }

    if(data.type == 345)
    {
        text    = "Timestamp is: " + data.timestamp + ", type is: " + data.type + ", payload is: " + data.payload
        $("#div2").html(text);
    }
}


//
// Perform a blocking send of an event to the remote device.
//
function BlockingSend( type, payload, completion )
{
    $.ajax({ url: "http://localhost:8080/SendAndReceive&type="+type+"?data="+payload,
        success: function(dataAsJSON)
        {
            data    = JSON.parse(dataAsJSON);
            completion(data);
        }
    });
}


//
// Repeatedly long-poll for events. This is how the remote device can communicate
// asynchronously with the js world.
//
(function PollForAsyncEvents()
{
   $.ajax({ url: "http://localhost:8080/AsyncPoll&type=314159265?data=919212313",
        success: function(dataAsJSON)
        {
            data    = JSON.parse(dataAsJSON);
            ProcessReceivedEvent(data);
        },
        complete: function(jqXHR,status)
        {
           PollForAsyncEvents();
        }
   });

})();







//
//
//
setInterval( function() {NonBlockingSend( 314159265, 919212313 );} , 2000);


//
//
//
function myFunction()
{
    NonBlockingSend( 2, 9090909 );
}


</script>
</head>
<body>

<div id="div1"><h2>Let jQuery AJAX Change This Text</h2></div>
<div id="div2"><h2>Let jQuery AJAX Change This Text</h2></div>

<button onclick="myFunction()">Click me</button>

</body>
</html>
