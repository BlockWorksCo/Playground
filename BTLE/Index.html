<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script>

count = 0;


//
// Perform a non-blocking send of an event to the remote device.
//
function NonBlockingSend(fn)
{
    $.ajax({ url: "http://localhost:8080/Send&type=314159265?data=919212313",
        success: function(data)
        {
            $("#div2").html('sddfsdf '+data);
        }
    });
}



//
// Perform a blocking receive for an event from the remote device.
//
function BlockingReceive(fn)
{
    //
    // Wait until ProcessReceivedEvent() has received our event-type.
    //
}


//
// All events received from the remote device end up here to be transformed
// into js events.
//
function ProcessReceivedEvent(dataAsJSON)
{
    data    = JSON.parse(dataAsJSON);
    text    = "Timestamp is: " + data.timestamp + ", type is: " + data.type + ", payload is: " + data.payload
    $("#div1").html(text);
}


//
// Perform a blocking send of an event to the remote device.
//
function BlockingSend(fn)
{
    $.ajax({ url: "http://localhost:8080/SendAndReceive&type=314159265?data=919212313",
        success: function(data)
        {
            $("#div2").html('sddfsdf '+data);
        }
    });
}


//
// Repeatedly long-poll for events. This is how the remote device can communicate
// asynchronously with the js world.
//
/*
(function PollForAsyncEvents()
{
   $.ajax({ url: "http://localhost:8080/AsyncPoll&type=314159265?data=919212313",
        success: function(data)
        {
           ProcessReceivedEvent(data);
        },
        complete: function(jqXHR,status)
        {
           PollForAsyncEvents();
        }
   });

})();
*/


//
// Send a request, block until response is received.
// (repeat every second).
//
function RepeatedSynchronousEventTest()
{
   $.ajax({ url: "http://localhost:8080/SendAndReceive&type=314159265?data=919212313",
        success: function(data)
        {
           ProcessReceivedEvent(data);
        },
        complete: function(jqXHR,status)
        {
           setTimeout( function() {RepeatedSynchronousEventTest();} , 1000);
        }
   });

};





//
//
//
RepeatedSynchronousEventTest();


</script>
</head>
<body>

<div id="div1"><h2>Let jQuery AJAX Change This Text</h2></div>
<div id="div2"><h2>Let jQuery AJAX Change This Text</h2></div>

</body>
</html>
