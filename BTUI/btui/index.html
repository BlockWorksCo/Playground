<!DOCTYPE html>
<html>
<head>
  <title>Welcome to Vue</title>
  <script src="https://unpkg.com/vue"></script>
  <script src="node_modules/axios/dist/axios.min.js"></script>
  <link href='https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons' rel="stylesheet">
  <link href="https://unpkg.com/vuetify/dist/vuetify.min.css" rel="stylesheet">
  <script src="https://unpkg.com/vuetify/dist/vuetify.js"></script>
</head>
<body>
  <div id="app">

<template>
  <v-app id="inspire" dark>
    <v-navigation-drawer
      clipped
      fixed
      v-model="drawer"
      app
    >
      <v-list dense>
        <v-list-tile @click="">
          <v-list-tile-action>
            <v-icon>dashboard</v-icon>
          </v-list-tile-action>
          <v-list-tile-content>
            <v-list-tile-title>Dashboard</v-list-tile-title>
          </v-list-tile-content>
        </v-list-tile>
        <v-list-tile @click="">
          <v-list-tile-action>
            <v-icon>settings</v-icon>
          </v-list-tile-action>
          <v-list-tile-content>
            <v-list-tile-title>Settings</v-list-tile-title>
          </v-list-tile-content>
        </v-list-tile>
      </v-list>
    </v-navigation-drawer>
    <v-toolbar app fixed clipped-left>
      <v-toolbar-side-icon @click.stop="drawer = !drawer"></v-toolbar-side-icon>
      <v-toolbar-title>Device List</v-toolbar-title>
    </v-toolbar>
    <v-content>
      <v-container fluid fill-height>
        <v-layout justify-center align-center>


            <template>
            <v-data-table
                v-bind:headers="headers"
                :items="items"
                class="elevation-1"
                hide-actions
                dark
                >
                <template slot="items" slot-scope="props" @click="showAlert">
                <tr @click="showAlert">
                <td >{{ props.item.name }}</td>
                <td class="text-xs-right">{{ props.item.address }}</td>
                <td class="text-xs-right">{{ props.item.rssi }}</td>
                </tr>
                </template>
            </v-data-table>
            </template>


        </v-layout>
      </v-container>
    </v-content>
    <v-footer app fixed>
      <span>&copy; 2017</span>
    </v-footer>
  </v-app>
</template>

  </div>

  <script>




    var app = new Vue({
      el: '#app',
      data: {
        drawer: null,
        greeting: 'Welcome to your Vue.js app!',
        docsURL: 'http://vuejs.org/guide/',
        discordURL: 'https://chat.vuejs.org',
        forumURL: 'http://forum.vuejs.org/',


        headers: [
        {
          text: 'Device name',
          align: 'left',
          sortable: false,
          value: 'name'
        },
        { text: 'Address', value: 'address' },
        { text: 'RSSI', value: 'rssi' },
      ],
      items: [] 

      },
      props: {
        source: String
      },
      methods: {
        showAlert(){
        alert('Alert!')
        },


        timerTick(){
              axios
              .get(`http://127.0.0.1:5000/DeviceList`)
              .then(response => {
                console.log(response.data);
                //app.message = response.data

                var value;
                var deviceList  = [];
                Object.keys(response.data).forEach(function(key) {
                    value = response.data[key];

                    var device  = {};
                    device.address = key;
                    device.name    = value['Name'];
                    device.rssi    = value['RSSI'];
                    deviceList.push(device)
                    //console.log(address+':'+name+':'+rssi);
                });
                app.items   = deviceList;

                window.setTimeout(this.timerTick, 1000);
              })
              .catch(e => {
                console.log(e)
                window.setTimeout(this.timerTick, 1000);
              })
            },

      },

        mounted: function() {
            window.setTimeout(this.timerTick, 1000);
        },



    })
  </script>
</body>
</html>
